#!/bin/bash
set -e

function getVersion() {
  if [ -f "$1" ]; then
    # Extrae la versión usando jq si está instalado, de lo contrario usa grep
    if command -v jq &>/dev/null; then
      version=$(jq -r '.version' "$1")
    else
      version=$(grep -o '"version": *"[^"]*"' "$1" | awk -F'": *"' '{print $2}' | tr -d '"')
    fi

    # Imprime la versión
    echo "$version"
  else
    echo "El archivo $1 no existe."
  fi
}

DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
ROOT=$DIR/../..
ROOT_PACKAGES=$ROOT/packages

set -a
# shellcheck disable=SC2034
MCENTER_VERSION=$(getVersion "$ROOT_PACKAGES/package.json")
# shellcheck disable=SC1091
. "$ROOT_PACKAGES"/.env
set +a

cd "$ROOT_PACKAGES"/server || exit
#pnpm test

cd "$ROOT_PACKAGES"/front || exit
#pnpm test

cd "$DIR" || exit

docker compose --profile "$ENV" up -d
